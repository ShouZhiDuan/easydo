# æ ‡ç­¾å…³ç³»æ¼”ç¤ºç¤ºä¾‹
---
# æ¼”ç¤ºï¼šä¸‰ä¸ªæ ‡ç­¾çš„ä½œç”¨å’Œå…³ç³»
apiVersion: apps/v1
kind: Deployment
metadata:
  name: label-demo-deployment
  labels:
    # ğŸ·ï¸ ä½ç½®1: Deploymentè‡ªèº«çš„æ ‡ç­¾ (å¯ä»¥ç‹¬ç«‹è®¾ç½®)
    app: my-deployment-label          # âœ… å¯ä»¥å’Œå…¶ä»–ä¸¤ä¸ªä¸åŒ
    version: v1.0
    component: web-frontend
spec:
  replicas: 2
  selector:
    # ğŸ¯ ä½ç½®2: Deploymenté€‰æ‹©Podçš„æ ‡ç­¾ (å¿…é¡»åŒ¹é…Podæ ‡ç­¾)
    matchLabels:
      app: my-pod-app                 # â— å¿…é¡»ä¸Pod templateæ ‡ç­¾å®Œå…¨åŒ¹é…
      tier: frontend
  template:
    metadata:
      labels:
        # ğŸ·ï¸ ä½ç½®3: Podå®é™…çš„æ ‡ç­¾ (å¿…é¡»åŒ¹é…selector)
        app: my-pod-app               # â— å¿…é¡»ä¸selector.matchLabelsåŒ¹é…
        tier: frontend                # â— å¿…é¡»ä¸selector.matchLabelsåŒ¹é…
        version: v1.0                 # âœ… å¯ä»¥æœ‰é¢å¤–æ ‡ç­¾
        instance: pod-instance
    spec:
      containers:
      - name: web-server
        image: nginx:1.21
        ports:
        - containerPort: 80

---
# Serviceé€‰æ‹©Pod
apiVersion: v1
kind: Service
metadata:
  name: label-demo-service
  labels:
    # ğŸ·ï¸ Serviceè‡ªèº«çš„æ ‡ç­¾ (å¯ä»¥ç‹¬ç«‹è®¾ç½®)
    app: my-service-label             # âœ… å¯ä»¥å’Œå…¶ä»–å®Œå…¨ä¸åŒ
    component: load-balancer
spec:
  type: ClusterIP
  selector:
    # ğŸ¯ Serviceé€‰æ‹©Podçš„æ ‡ç­¾ (å¿…é¡»åŒ¹é…Podæ ‡ç­¾)
    app: my-pod-app                   # â— å¿…é¡»åŒ¹é…Podä¸Šçš„æ ‡ç­¾
    tier: frontend                    # â— å¿…é¡»åŒ¹é…Podä¸Šçš„æ ‡ç­¾
  ports:
    - port: 80
      targetPort: 80

---
# å¯¹æ¯”ï¼šé”™è¯¯çš„é…ç½®ç¤ºä¾‹ (æ³¨é‡Šæ‰ï¼Œä»…ç”¨äºè¯´æ˜)
# apiVersion: v1
# kind: Service
# metadata:
#   name: wrong-service
# spec:
#   selector:
#     app: wrong-label              # âŒ æ‰¾ä¸åˆ°åŒ¹é…çš„Podï¼ŒServiceæ— æ•ˆ
#   ports:
#     - port: 80 